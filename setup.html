<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Mobster</title>
    <link rel="stylesheet" href="./assets/css/bootstrap337.min.css" />
    <link rel="stylesheet" href="./assets/css/bootstrap-darkly-theme.min.css" />
    <link rel="stylesheet" href="./assets/css/font-awesome.min.css" />
    <link rel="stylesheet" href="./index.css" />
    <script type="text/javascript" src="./elm.js"></script>
    <script>window.Elm = require('./elm.js')</script>
    <script type="text/javascript">
    const $ = jQuery = require('jquery')
    </script>
    <style>
      html,body {
        -webkit-user-select: none;
        user-select: none;
        width: 100%;
        height: 100%;
        padding: 50px;
        cursor:default;
      }
      h1, .h1 {
        font-size: 2.6em
      }
      h2, .h2 {
        font-size: 2.133em;
      }
      h3, .h3 {
        font-size: 2.0em;
      }

      .tip {
        -webkit-user-select: text;
        user-select: text;
        cursor: auto;
      }

      .btn:focus {
        outline: none;
      }

      .btn:active {
        outline: none;
      }

      .btn:active:focus {
        outline: none;
      }

      .transparent {
        opacity: .08 !important;
        background-color: rgba(150, 150, 150, 0.08);
      }

      .role-icon {
        margin-left: 10px;
        width: 20px;
      }

      .shuffle:hover {
        opacity: 1;
      }

      .shuffle {
        opacity: 0.5;
      }

      .no-role-icon {
        content: url(./assets/driver-icon.png);
        opacity: 0.08;
      }

      .active-mobster:hover .no-role-icon {
        opacity: 1;
      }

      .driver-icon {
        opacity: 0.8;
        content: url(./assets/driver-icon.png);
      }

      .active-mobster:hover .driver-icon {
        opacity: 0.9;
        content: url(./assets/driver-icon.png);
      }

      .navigator-icon {
        opacity: 0.08;
        content: url(./assets/navigator-icon.png);
      }

      .active-mobster:hover .navigator-icon {
        opacity: 1;
        content: url(./assets/driver-icon.png);
      }

      .inactive-mobster {
        color: gray;
      }

      .inactive-mobster:hover::before {
        content: "Â«";
        color: orange;
      }

      .inactive-mobster:hover {
        color: white;
      }
      img {
        -webkit-user-select: none;
        user-select: none;
      }

      /* Tooltip CSS  - help from https://jsfiddle.net/greypants/zgCb7/ */
      .my-tooltip-outer {
        -webkit-transform: translateZ(0);
        -webkit-font-smoothing: antialiased;
      }

      .my-tooltip-outer .my-tooltip-inner {
        left: 50% !important;
        right: auto !important;
        text-align: center !important;
        transform: translate(-50%, 0) !important;


        font-size: 2.5rem;
        background: rgba(14, 255, 125, 1);
        bottom: 100%;
        color: #fff;
        display: block;
        /*left: -25px;*/
        left: 0px;
        margin-bottom: 15px;
        opacity: 0;
        padding: 20px;
        pointer-events: none;
        position: absolute;
        -webkit-transform: translateY(10px);
        transform: translateY(10px);
        -webkit-transition: all .15s ease-out;
        transition: all .15s ease-out;
        -webkit-box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.28);
        box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.28);
      }


      /* This bridges the gap so you can mouse into the tooltip without it disappearing */
      .my-tooltip-outer .my-tooltip-inner:before {
        bottom: -20px;
        content: " ";
        display: block;
        height: 20px;
        left: 0;
        position: absolute;
        width: 100%;
      }


      /* CSS Triangle */
      .my-tooltip-outer .my-tooltip-inner:after {
        border-left: solid transparent 10px;
        border-right: solid transparent 10px;
        border-top: solid rgba(14, 255, 125, 1) 10px;
        bottom: -10px;
        content: " ";
        height: 0;
        left: 50%;
        margin-left: -13px;
        position: absolute;
        width: 0;
      }

      .my-tooltip-outer:hover .my-tooltip-inner {
        opacity: 1;
        pointer-events: auto;
        -webkit-transform: translateY(0px);
        transform: translateY(0px);
      }
      </style>
  </head>
  <body id="setup-window">
  </body>

  <script>
    const {ipcRenderer, clipboard} = require('electron')
    const {version} = require('./package')
    console.log(`Running version ${version}`)

    let settings = JSON.parse(window.localStorage.getItem('settings'))
    let setup = Elm.Setup.Main.fullscreen(settings)

    setup.ports.startTimer.subscribe(function(flags) {
      ipcRenderer.send('start-timer', flags)
    })

    setup.ports.quit.subscribe(function() {
      ipcRenderer.send('quit')
    })

    setup.ports.selectDuration.subscribe(function(id) {
      document.getElementById(id).select()
    })

    setup.ports.quitAndInstall.subscribe(function() {
      ipcRenderer.send('quit-and-install')
    })

    setup.ports.copyActiveMobsters.subscribe(function(activeMobsters) {
      clipboard.writeText(activeMobsters)
    })

    setup.ports.saveSettings.subscribe(function(settings) {
      window.localStorage.setItem('settings', JSON.stringify(settings))
    })

    ipcRenderer.on('update-downloaded', function (event, updatedVersion) {
      console.log('on update-downloaded. updatedVersion = ', updatedVersion)
      setup.ports.updateDownloaded.send("Not a real version...")
    })

    ipcRenderer.on('timer-done', function (event, elapsedSeconds) {
      setup.ports.timeElapsed.send(elapsedSeconds)
    })

    ipcRenderer.on('copy-active-mobsters', function (event) {
      setup.ports.onCopyMobstersShortcut.send(null)
    })

    $(() => {
      $('.invisible-trigger').hover(
        () => { $('body').addClass('transparent') },
        () => { $('body').removeClass('transparent') }
      )
    })

  </script>
    <script src="./assets/js/bootstrap337.min.js" crossorigin="anonymous"></script>
</html>
